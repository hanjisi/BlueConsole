<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueConsole Pro</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-panel: #1e1e1e;
            --bg-sidebar: #181818;
            --primary: #2196F3;
            --text-main: #ffffff;
            --text-dim: #aaaaaa;
            --border: #333333;
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* --- å¸ƒå±€å®¹å™¨ --- */
        .app-container { display: flex; flex-direction: column; height: 100%; transition: transform 0.3s; }

        /* --- é¡¶éƒ¨æ  --- */
        .header {
            height: 50px; background: var(--bg-panel); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 16px; justify-content: space-between;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .menu-btn { cursor: pointer; font-size: 20px; padding: 5px; }
        .current-profile-name { font-weight: bold; font-size: 16px; display: flex; flex-direction: column; }
        .current-profile-sub { font-size: 10px; color: var(--primary); font-weight: normal;}

        /* --- ä¾§è¾¹æ  (Sidebar) --- */
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 900;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .sidebar-overlay.open { opacity: 1; pointer-events: auto; }

        .sidebar {
            position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width);
            background: var(--bg-sidebar); z-index: 901;
            transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; border-right: 1px solid var(--border);
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }
        .sidebar.open { transform: translateX(0); }

        .sidebar-header { padding: 20px 16px; border-bottom: 1px solid var(--border); background: #252525;}
        .sidebar-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .sidebar-desc { font-size: 12px; color: #888; }

        .profile-list { flex: 1; overflow-y: auto; padding: 10px 0; }
        .profile-item {
            padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            border-left: 3px solid transparent;
        }
        .profile-item:hover { background: #222; }
        .profile-item.active { background: #2c2c2c; border-left-color: var(--primary); }
        .profile-info h4 { margin: 0; font-size: 14px; }
        .profile-info p { margin: 2px 0 0 0; font-size: 11px; color: #666; }
        .profile-actions { opacity: 0; color: #aaa; font-size: 12px; }
        .profile-item:hover .profile-actions { opacity: 1; }

        .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); background: #202020; }
        .action-btn {
            display: block; width: 100%; padding: 10px; margin-bottom: 8px;
            background: #333; color: white; border: 1px solid #444; border-radius: 4px;
            cursor: pointer; text-align: center; font-size: 13px;
        }
        .action-btn:hover { background: #444; }
        .action-btn.primary { background: var(--primary); border: none; }

        /* --- ä¸»å†…å®¹åŒº (æ—¥å¿— + æ“ä½œ) --- */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .log-area { flex: 1; background: #000; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 13px; }
        .splitter { height: 10px; background: #2d2d2d; cursor: row-resize; flex-shrink: 0; text-align:center; line-height:2px; color:#555;}
        .operation-area { height: 300px; background: var(--bg-dark); display: flex; flex-direction: column; }
        
        /* ç®€å•æ¨¡æ‹Ÿæ“ä½œåŒºæ ·å¼ */
        .tabs { display: flex; background: #1a1a1a; border-bottom: 1px solid #333; }
        .tab { padding: 10px 20px; cursor: pointer; color: #888; border-bottom: 2px solid transparent;}
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: #252525; }
        .tab-add { margin-left: auto; padding: 10px; cursor: pointer; }

        .cmd-container { flex: 1; padding: 10px; overflow-y: auto; }
        .cmd-group { margin-bottom: 15px; border: 1px solid #333; border-radius: 4px; }
        .group-header { padding: 8px; background: #252525; font-size: 12px; color: #aaa; font-weight: bold; }
        .group-body { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
        .cmd-btn { padding: 8px 12px; background: #333; border: 1px solid #444; border-radius: 4px; color: #eee; cursor: pointer; font-size: 12px;}

        /* --- Modal --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-box { background: var(--bg-panel); width: 90%; max-width: 400px; padding: 20px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.8); }
        .form-group { margin-bottom: 15px; }
        .label { display: block; color: #888; margin-bottom: 5px; font-size: 12px; }
        .input { width: 100%; padding: 8px; background: #121212; border: 1px solid #444; color: white; border-radius: 4px; }
        .btn-row { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        
        /* ç»„åˆè¾“å…¥æ¡†æ ·å¼ (ä¸ºäº†æ”¯æŒæ–°å»ºåˆ†ç»„) */
        .combo-box { position: relative; }
        .combo-select { width: 100%; padding: 8px; background: #121212; border: 1px solid #444; color: white; border-radius: 4px; appearance: none; }
        .combo-input { display:none; width: 100%; padding: 8px; background: #121212; border: 1px solid var(--primary); color: white; border-radius: 4px; }
        .combo-input.show { display: block; }
        .combo-toggle { position: absolute; right: 10px; top: 8px; font-size: 10px; color: var(--primary); cursor: pointer; }

    </style>
</head>
<body>

<div class="sidebar-overlay" onclick="toggleSidebar()"></div>

<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-title">é…ç½®æ–‡ä»¶</div>
        <div class="sidebar-desc">ç®¡ç†æ‚¨çš„è®¾å¤‡é…ç½®åº“</div>
    </div>
    
    <div class="profile-list" id="profileList">
        </div>

    <div class="sidebar-footer">
        <button class="action-btn" onclick="importFromURL()">â˜ï¸ ä» URL å¯¼å…¥</button>
        <button class="action-btn" onclick="importFromPaste()">ğŸ“‹ ç²˜è´´ JSON å¯¼å…¥</button>
        <button class="action-btn primary" onclick="createNewProfile()">+ æ–°å»ºç©ºç™½é…ç½®</button>
    </div>
</div>

<div class="app-container">
    <div class="header">
        <div class="header-left">
            <div class="menu-btn" onclick="toggleSidebar()">â˜°</div>
            <div class="current-profile-name">
                <span id="headerProfileName">æœªå‘½åé…ç½®</span>
                <span class="current-profile-sub">ç‚¹å‡»å·¦ä¾§èœå•åˆ‡æ¢</span>
            </div>
        </div>
        <div style="font-size: 12px; color: #00E676;">â— Connected</div>
    </div>

    <div class="main-content">
        <div class="log-area">
            <div>[System] Ready.</div>
            <div>[System] Loaded profile commands.</div>
        </div>
        <div class="splitter">====</div>
        <div class="operation-area">
            <div class="tabs">
                <div class="tab active">ç®€å•æŒ‡ä»¤</div>
                <div class="tab">è¾“å…¥æŒ‡ä»¤</div>
                <div class="tab">æšä¸¾æŒ‡ä»¤</div>
                <div class="tab-add" onclick="openAddModal()">+</div>
            </div>
            <div class="cmd-container" id="cmdContainer">
                </div>
        </div>
    </div>
</div>

<div class="modal" id="addModal">
    <div class="modal-box">
        <h3 style="margin-top:0">æ·»åŠ ç®€å•æŒ‡ä»¤</h3>
        
        <div class="form-group">
            <label class="label">æŒ‡ä»¤åç§°</label>
            <input type="text" class="input" placeholder="ä¾‹å¦‚ï¼šå¼€å¯ç”µæœº">
        </div>

        <div class="form-group">
            <label class="label">æ‰€å±åˆ†ç»„</label>
            <div class="combo-box">
                <select class="combo-select" id="groupSelect" onchange="checkNewGroup(this)">
                    <option value="">-- è¯·é€‰æ‹©åˆ†ç»„ --</option>
                    <option value="__NEW__" style="color: var(--primary);">+ æ–°å»ºåˆ†ç»„...</option>
                </select>
                <input type="text" class="combo-input" id="newGroupInput" placeholder="è¾“å…¥æ–°åˆ†ç»„åç§°">
                <span class="combo-toggle" onclick="resetGroupSelect()" id="resetGroupBtn" style="display:none">å–æ¶ˆæ–°å»º</span>
            </div>
        </div>

        <div class="form-group">
            <label class="label">æŒ‡ä»¤å†…å®¹</label>
            <textarea class="input" rows="3"></textarea>
        </div>

        <div class="btn-row">
            <button class="action-btn" onclick="closeAddModal()" style="width:auto">å–æ¶ˆ</button>
            <button class="action-btn primary" onclick="saveCommand()" style="width:auto">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
    // --- æ¨¡æ‹Ÿæ•°æ® (æœ¬åœ°å­˜å‚¨ç»“æ„) ---
    // å®é™…å¼€å‘ä¸­ï¼Œè¿™é‡Œçš„æ•°æ®ä¼šå­˜å‚¨åœ¨ localStorage æˆ– æ•°æ®åº“ä¸­
    let profiles = [
        {
            id: 'p1',
            name: 'æ— äººæœºè°ƒè¯• (Drone)',
            desc: 'ç”¨äºè°ƒè¯• F450 æœºæ¶é£æ§',
            groups: [
                { name: 'ç”µæœºæ§åˆ¶', cmds: ['è§£é”', 'èµ·é£', 'é™è½'] },
                { name: 'ä¼ æ„Ÿå™¨æ ¡å‡†', cmds: ['æ ¡å‡†é™€èºä»ª', 'æ ¡å‡†ç½—ç›˜'] }
            ]
        },
        {
            id: 'p2',
            name: 'æ™ºèƒ½ç¯æ§ (SmartHome)',
            desc: 'å®¢å…å¸é¡¶ç¯æµ‹è¯•',
            groups: [
                { name: 'è‰²å½©æµ‹è¯•', cmds: ['çº¢å…‰', 'ç»¿å…‰', 'è“å…‰', 'æš–ç™½'] },
                { name: 'äº®åº¦æµ‹è¯•', cmds: ['10%', '50%', '100%'] }
            ]
        }
    ];

    let currentProfileId = 'p1';

    // --- ä¾§è¾¹æ é€»è¾‘ ---
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.querySelector('.sidebar-overlay').classList.toggle('open');
        renderProfileList(); // æ¯æ¬¡æ‰“å¼€åˆ·æ–°åˆ—è¡¨
    }

    function renderProfileList() {
        const listEl = document.getElementById('profileList');
        listEl.innerHTML = '';
        
        profiles.forEach(p => {
            const isActive = p.id === currentProfileId;
            const div = document.createElement('div');
            div.className = `profile-item ${isActive ? 'active' : ''}`;
            div.onclick = () => switchProfile(p.id);
            div.innerHTML = `
                <div class="profile-info">
                    <h4>${p.name}</h4>
                    <p>${p.desc}</p>
                </div>
                <div class="profile-actions" onclick="event.stopPropagation(); deleteProfile('${p.id}')">
                    ğŸ—‘ï¸
                </div>
            `;
            listEl.appendChild(div);
        });
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šåˆ‡æ¢é…ç½®æ–‡ä»¶ ---
    function switchProfile(id) {
        currentProfileId = id;
        const profile = profiles.find(p => p.id === id);
        
        // 1. æ›´æ–°é¡¶éƒ¨æ ‡é¢˜
        document.getElementById('headerProfileName').innerText = profile.name;
        
        // 2. æ›´æ–°ä¸‹æ–¹æŒ‡ä»¤åŒº (è¿™é‡Œä¸»è¦æ¼”ç¤ºæ•°æ®åˆ·æ–°)
        renderCommands(profile);
        
        // 3. å…³é—­ä¾§è¾¹æ 
        toggleSidebar();
        
        // 4. æ¨¡æ‹Ÿæ—¥å¿—æç¤º
        const logArea = document.querySelector('.log-area');
        const entry = document.createElement('div');
        entry.innerText = `[System] Switched to profile: ${profile.name}`;
        entry.style.color = '#ffff00';
        logArea.appendChild(entry);
    }

    // æ¸²æŸ“æŒ‡ä»¤åŒºå†…å®¹
    function renderCommands(profile) {
        const container = document.getElementById('cmdContainer');
        container.innerHTML = '';
        
        if(!profile.groups || profile.groups.length === 0) {
            container.innerHTML = '<div style="color:#666; text-align:center; margin-top:20px;">æš‚æ— æŒ‡ä»¤ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ </div>';
            return;
        }

        profile.groups.forEach(g => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'cmd-group';
            
            let btnsHtml = g.cmds.map(c => `<div class="cmd-btn">${c}</div>`).join('');
            
            groupDiv.innerHTML = `
                <div class="group-header">${g.name}</div>
                <div class="group-body">${btnsHtml}</div>
            `;
            container.appendChild(groupDiv);
        });
    }

    // --- å¯¼å…¥åŠŸèƒ½æ¨¡æ‹Ÿ ---
    function importFromPaste() {
        const jsonStr = prompt("è¯·åœ¨æ­¤ç²˜è´´é…ç½®æ–‡ä»¶çš„ JSON å†…å®¹ï¼š");
        if (jsonStr) {
            try {
                // æ¨¡æ‹Ÿè§£æ
                const newProfile = {
                    id: 'p' + Date.now(),
                    name: 'å¯¼å…¥çš„é…ç½® ' + (profiles.length + 1),
                    desc: 'æ¥æºï¼šå‰ªè´´æ¿å¯¼å…¥',
                    groups: []
                };
                profiles.push(newProfile);
                alert("å¯¼å…¥æˆåŠŸï¼");
                renderProfileList();
            } catch (e) {
                alert("JSON æ ¼å¼é”™è¯¯");
            }
        }
    }

    function createNewProfile() {
        const name = prompt("è¯·è¾“å…¥æ–°é…ç½®åç§°ï¼š");
        if(name) {
            profiles.push({
                id: 'p' + Date.now(),
                name: name,
                desc: 'æœ¬åœ°æ–°å»º',
                groups: []
            });
            renderProfileList();
        }
    }

    function deleteProfile(id) {
        if(confirm("ç¡®å®šåˆ é™¤æ­¤é…ç½®å—ï¼Ÿ")) {
            if (profiles.length <= 1) {
                alert("è‡³å°‘ä¿ç•™ä¸€ä¸ªé…ç½®");
                return;
            }
            profiles = profiles.filter(p => p.id !== id);
            if(currentProfileId === id) {
                switchProfile(profiles[0].id);
            }
            renderProfileList();
        }
    }

    // --- æ¨¡æ€æ¡†ä¸æ–°å»ºåˆ†ç»„é€»è¾‘ ---
    function openAddModal() {
        document.getElementById('addModal').classList.add('show');
        
        // å¡«å……å½“å‰ Profile çš„ç°æœ‰åˆ†ç»„
        const select = document.getElementById('groupSelect');
        const profile = profiles.find(p => p.id === currentProfileId);
        
        // æ¸…ç©ºæ—§é€‰é¡¹ï¼Œä¿ç•™é»˜è®¤å’Œæ–°å»º
        select.innerHTML = `<option value="">-- è¯·é€‰æ‹©åˆ†ç»„ --</option>`;
        
        if(profile.groups) {
            profile.groups.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g.name;
                opt.innerText = g.name;
                select.appendChild(opt);
            });
        }
        
        // æ·»åŠ æ–°å»ºé€‰é¡¹
        const newOpt = document.createElement('option');
        newOpt.value = "__NEW__";
        newOpt.innerText = "+ æ–°å»ºåˆ†ç»„...";
        newOpt.style.color = "var(--primary)";
        select.appendChild(newOpt);
    }

    function closeAddModal() {
        document.getElementById('addModal').classList.remove('show');
        resetGroupSelect();
    }

    // æ ¸å¿ƒï¼šæ£€æµ‹æ˜¯å¦é€‰æ‹©äº†â€œæ–°å»ºåˆ†ç»„â€
    function checkNewGroup(selectObj) {
        if(selectObj.value === "__NEW__") {
            // éšè—ä¸‹æ‹‰æ¡†ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
            selectObj.style.display = 'none';
            document.getElementById('newGroupInput').style.display = 'block';
            document.getElementById('newGroupInput').focus();
            document.getElementById('resetGroupBtn').style.display = 'block';
        }
    }

    function resetGroupSelect() {
        const select = document.getElementById('groupSelect');
        select.style.display = 'block';
        select.value = "";
        
        document.getElementById('newGroupInput').style.display = 'none';
        document.getElementById('newGroupInput').value = "";
        document.getElementById('resetGroupBtn').style.display = 'none';
    }

    function saveCommand() {
        // ç®€å•æ¨¡æ‹Ÿä¿å­˜
        alert("æŒ‡ä»¤ä¿å­˜é€»è¾‘ï¼š\n1. åˆ¤æ–­æ˜¯å¦æ–°å»ºåˆ†ç»„ \n2. å†™å…¥å½“å‰ profiles æ•°ç»„ \n3. åˆ·æ–°ç•Œé¢");
        closeAddModal();
        // å®é™…æ“ä½œä¸­ä¼šè°ƒç”¨ switchProfile(currentProfileId) æ¥åˆ·æ–°ç•Œé¢
    }

    // åˆå§‹åŒ–
    switchProfile('p1');

</script>

</body>
</html>